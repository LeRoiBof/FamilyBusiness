{% extends "master.html" %}

{% block content %}
<section class="section">
    <div class="container">
        <!-- En-tête -->
        <div class="level mb-5">
            <div class="level-left">
                <div class="level-item">
                    <div>
                        <h1 class="title is-3 has-text-danger mb-1">Supprimer l'utilisateur</h1>
                    </div>
                </div>
            </div>
        </div>

        <div class="columns is-centered">
            <div class="column is-half-tablet is-two-thirds-desktop">
                <div class="card">
                    <div class="card-header">
                        <div class="card-header-title has-text-danger">
                            <span class="icon mr-2"><i class="mdi mdi-alert-circle"></i></span>
                            Confirmation de suppression
                        </div>
                    </div>

                    <div class="card-content">
                        <!-- Infos utilisateur -->
                        <div class="notification is-light mb-5 no-dismiss">
                            <div class="media">
                                <div class="media-left">
                                    <span class="icon is-large {% if user_to_delete.is_staff %}has-text-warning{% else %}has-text-primary{% endif %}">
                                        <i class="mdi mdi-48px {% if user_to_delete.is_staff %}mdi-shield-account{% else %}mdi-account{% endif %}"></i>
                                    </span>
                                </div>
                                <div class="media-content">
                                    <p class="title is-4">{{ user_to_delete.get_full_name }}</p>
                                    <p class="subtitle is-6 has-text-grey mb-2">{{ user_to_delete.email }}</p>
                                    <div class="tags">
                                        {% if user_to_delete.is_staff %}
                                            <span class="tag is-warning"><i class="mdi mdi-shield mr-1"></i> Admin</span>
                                        {% else %}
                                            <span class="tag is-light">{{ user_to_delete.role|default:"Utilisateur"|capfirst }}</span>
                                        {% endif %}
                                        {% if user_to_delete.is_active %}
                                            <span class="tag is-success">Actif</span>
                                        {% else %}
                                            <span class="tag is-danger">Inactif</span>
                                        {% endif %}
                                        <span class="tag is-info">Inscrit le {{ user_to_delete.date_joined|date:"d/m/Y" }}</span>
                                    </div>
                                    {% if user_to_delete.last_login %}
                                        <p class="has-text-grey mt-2">
                                            <i class="mdi mdi-clock mr-1"></i> Dernière connexion : {{ user_to_delete.last_login|date:"d/m/Y à H:i" }}
                                        </p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Impact -->
                        <div class="notification is-warning no-dismiss">
                            <p><strong><i class="mdi mdi-alert"></i> Impact de la suppression :</strong></p>
                            <ul class="mt-3">
                                <li><strong>{{ impact_info.wallet_count }}</strong> portefeuille{{ impact_info.wallet_count|pluralize }} associé{{ impact_info.wallet_count|pluralize }}</li>
                                <li><strong>{{ impact_info.transaction_count }}</strong> transaction{{ impact_info.transaction_count|pluralize }} enregistrée{{ impact_info.transaction_count|pluralize }}</li>
                                {% if impact_info.shared_wallets.exists %}
                                    <li class="has-text-danger">
                                        <strong>Attention :</strong> L'utilisateur partage des portefeuilles avec d'autres membres
                                    </li>
                                {% endif %}
                            </ul>
                        </div>

                        {% if impact_info.wallet_count > 0 %}
                        <div class="card mt-5">
                            <div class="card-header">
                                <div class="card-header-title">
                                    <span class="icon mr-2"><i class="mdi mdi-wallet"></i></span>
                                    Portefeuilles affectés
                                </div>
                            </div>
                            <div class="card-content">
                                {% if impact_info.shared_wallets.exists %}
                                    <div class="notification is-danger is-light mb-4 no-dismiss">
                                        <p><strong>Portefeuilles partagés :</strong></p>
                                        <p>Ces portefeuilles ne seront pas supprimés, mais l'utilisateur y perdra l'accès.</p>
                                    </div>
                                {% endif %}
                                <div class="content is-small">
                                    <ul>
                                        <li>Les transactions resteront dans l'historique</li>
                                        <li>Les partages seront révoqués</li>
                                        <li>L'utilisateur sera définitivement supprimé</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Avertissements -->
                        <div class="notification is-danger mt-5 no-dismiss">
                            <p><strong><i class="mdi mdi-shield-alert"></i> Mesures de sécurité :</strong></p>
                            <ul class="mt-3">
                                <li>Suppression <strong>définitive et irréversible</strong></li>
                                <li>Toutes les sessions actives seront révoquées</li>
                                <li>L'adresse email pourra être réutilisée</li>
                                <li>Un événement sera enregistré dans l'historique</li>
                            </ul>
                        </div>

                        <!-- Formulaire de suppression -->
                        <form method="post" class="mt-5" id="delete-form">
                            {% csrf_token %}
                            <div class="field is-grouped is-grouped-right">
                                <div class="control">
                                    <a href="{% url 'adminpanel:user_management' %}" class="button is-light is-medium">
                                        <i class="mdi mdi-close mr-1"></i> Annuler
                                    </a>
                                </div>
                                <div class="control">
                                    <button type="submit" class="button is-danger is-medium" id="delete-btn">
                                        <i class="mdi mdi-account-remove mr-1"></i> Supprimer définitivement
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}
