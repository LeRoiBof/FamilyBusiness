{% extends "master.html" %}

{% block content %}
<section class="section">
    <div class="container">
        <!-- En-tête -->
        <div class="level mb-5">
            <div class="level-left">
                <div class="level-item">
                    <h1 class="title is-3 has-text-danger">Supprimer le portefeuille</h1>
                </div>
            </div>
        </div>

        <div class="columns is-centered">
            <!-- Carte suppression -->
            <div class="column">
                <div class="card">
                    <div class="card-header">
                        <div class="card-header-title has-text-danger">
                            <span class="icon mr-2"><i class="mdi mdi-alert-circle"></i></span>
                            Confirmation de suppression
                        </div>
                    </div>

                    <div class="card-content">
                        <!-- Infos portefeuille -->
                        <div class="notification is-light mb-5 no-dismiss">
                            <div class="media">
                                <div class="media-left">
                                    <span class="icon is-large {% if impact_info.users_affected|length > 1 %}has-text-info{% else %}has-text-primary{% endif %}">
                                        <i class="mdi mdi-48px {% if impact_info.users_affected|length > 1 %}mdi-wallet-membership{% else %}mdi-wallet{% endif %}"></i>
                                    </span>
                                </div>
                                <div class="media-content">
                                    <p class="title is-4">{{ wallet.name }}</p>
                                    <p class="subtitle is-6 has-text-grey mb-2">Propriétaire : {{ wallet.owner.get_full_name }}</p>
                                    <div class="tags">
                                        <span class="tag is-info"><i class="mdi mdi-currency-eur mr-1"></i> Solde : {{ wallet.balance|floatformat:2 }} €</span>
                                        <span class="tag is-warning"><i class="mdi mdi-target mr-1"></i> Objectif : {{ wallet.objective|floatformat:2 }} €</span>
                                        {% if impact_info.users_affected|length > 1 %}
                                            <span class="tag is-primary"><i class="mdi mdi-account-group mr-1"></i> Partagé</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Impact -->
                        <div class="notification is-warning no-dismiss">
                            <p><strong><i class="mdi mdi-alert"></i> Impact de la suppression :</strong></p>
                            <ul class="mt-3">
                                <li><strong>{{ impact_info.transaction_count }}</strong> transaction{{ impact_info.transaction_count|pluralize }} supprimée{{ impact_info.transaction_count|pluralize }}</li>
                            </ul>
                        </div>

                        <!-- Utilisateurs -->
                        {% if impact_info.users_affected %}
                        <div class="card mt-5">
                            <div class="card-header">
                                <div class="card-header-title">
                                    <span class="icon mr-2"><i class="mdi mdi-account-group"></i></span>
                                    Utilisateurs affectés
                                </div>
                            </div>
                            <div class="card-content">
                                <p class="mb-3">Les utilisateurs suivants perdront l'accès :</p>
                                {% for user in impact_info.users_affected %}
                                <div class="media">
                                    <div class="media-left">
                                        <span class="icon {% if user.id == wallet.owner.id %}has-text-warning{% else %}has-text-primary{% endif %}">
                                            <i class="mdi {% if user.id == wallet.owner.id %}mdi-crown{% else %}mdi-account{% endif %}"></i>
                                        </span>
                                    </div>
                                    <div class="media-content">
                                        <p class="has-text-weight-semibold">
                                            {{ user.get_full_name }}
                                            {% if user.id == wallet.owner.id %}
                                                <span class="tag is-warning is-small ml-2">Propriétaire</span>
                                            {% endif %}
                                        </p>
                                        <p class="is-size-7 has-text-grey">{{ user.email }}</p>
                                    </div>
                                </div>
                                {% if not forloop.last %}<hr class="my-3">{% endif %}
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}

                        <!-- Avertissements -->
                        <div class="notification is-danger mt-5 no-dismiss">
                            <p><strong><i class="mdi mdi-shield-alert"></i> Mesures de sécurité :</strong></p>
                            <ul class="mt-3">
                                <li>Suppression <strong>définitive</strong></li>
                                <li>Transactions définitivement perdues</li>
                                <li>Historique non récupérable</li>
                                <li>Accès révoqué</li>
                                <li>Événement enregistré</li>
                            </ul>
                        </div>

                        <!-- Formulaire -->
                        <form method="post" class="mt-5" id="deleteForm">
                            {% csrf_token %}
                            <div class="field is-grouped is-grouped-right">
                                <div class="control">
                                    <a href="{% url 'adminpanel:wallet_management' %}" class="button is-light is-medium">
                                        <i class="mdi mdi-close mr-1"></i> Annuler
                                    </a>
                                </div>
                                <div class="control">
                                    <button type="submit" class="button is-danger is-medium" id="deleteBtn">
                                        <i class="mdi mdi-delete mr-1"></i> Supprimer définitivement
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}
